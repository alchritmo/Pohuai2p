<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨å³¶ä¹‹å¾Œ - æ™ºèƒ½é»é¤èˆ‡è‡ªå‹•å°è¨ˆ</title>
    <style>
        :root {
            --bg-color: #0b2d35;
            --accent-color: #ffffff;
            --highlight-color: #4db6ac;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--accent-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container { width: 100%; max-width: 650px; }

        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .header h1 { font-size: 1.8rem; letter-spacing: 5px; margin: 0; }

        /* äººå“¡ç®¡ç† */
        .personnel-section { background: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input[type="text"] { flex-grow: 1; padding: 10px; border-radius: 4px; border: 1px solid var(--border-color); background: rgba(0,0,0,0.3); color: white; }
        .add-btn { background: var(--highlight-color); border: none; color: white; padding: 0 15px; border-radius: 4px; cursor: pointer; }
        .person-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .person-tag { background: rgba(255,255,255,0.1); padding: 6px 15px; border-radius: 20px; cursor: pointer; border: 1px solid transparent; }
        .person-tag.active { border-color: var(--highlight-color); background: rgba(77, 182, 172, 0.3); font-weight: bold; }

        /* èœå–®å€ */
        .menu-card { background: var(--card-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .category-title { font-size: 1.1rem; color: var(--highlight-color); border-left: 4px solid var(--highlight-color); padding-left: 10px; margin: 25px 0 15px 0; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .price { color: #ffd54f; font-weight: bold; min-width: 70px; text-align: right; margin-right: 15px; }

        /* çµå¸³å°è¨ˆè¡¨æ ¼ */
        .summary-section { background: #fff; color: #333; padding: 20px; border-radius: 8px; margin-top: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .summary-section h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; color: var(--bg-color); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; border-bottom: 1px solid #ddd; padding: 10px; background: #f9f9f9; }
        td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
        .total-row { font-weight: bold; font-size: 1.2rem; color: #d32f2f; background: #fffde7; }

        /* å›ºå®šé€å‡ºæŒ‰éˆ• */
        .submit-area { position: sticky; bottom: 20px; text-align: center; padding: 20px 0; z-index: 100; }
        #submitBtn { background: #fff; color: var(--bg-color); border: none; padding: 15px 60px; font-size: 1.1rem; font-weight: bold; border-radius: 35px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.4); transition: 0.2s; }
        #submitBtn:active { transform: translateY(3px); }

        /* æ—¥èªŒ */
        .status-panel { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-top: 20px; font-family: monospace; font-size: 0.8rem; opacity: 0.7; }
        .status-line { color: #88ff88; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>åœ¨å³¶ä¹‹å¾Œ</h1>
        <p>AFTER ISLAND - åœ˜é«”é»é¤ç³»çµ±</p>
    </div>

    <div class="personnel-section">
        <div style="margin-bottom: 10px;">ç›®å‰é»é¤ï¼š<b id="currentUserDisplay" style="color:var(--highlight-color)">ä¸€èµ·åƒ</b></div>
        <div class="input-group">
            <input type="text" id="personNameInput" placeholder="è¼¸å…¥åŒäº‹/æœ‹å‹å§“å...">
            <button class="add-btn" onclick="addPerson()">æ–°å¢</button>
        </div>
        <div class="person-list" id="personList">
            <div class="person-tag active" onclick="selectPerson(this)">ä¸€èµ·åƒ</div>
        </div>
    </div>

    <div class="menu-card" id="menuContent">
        </div>

    <div class="submit-area">
        <button id="submitBtn" onclick="sendOrder()">ç¢ºå®šé€å‡º (åŠ åˆ°æˆ‘çš„å¸³å–®)</button>
    </div>

    <div class="summary-section">
        <h3>ğŸ’° çµå¸³å°è¨ˆæ¸…å–®</h3>
        <table id="summaryTable">
            <thead>
                <tr>
                    <th>å§“å</th>
                    <th>é»é¤ç´°ç¯€</th>
                    <th>å°è¨ˆ</th>
                </tr>
            </thead>
            <tbody id="summaryBody">
                <tr><td colspan="3" style="text-align:center; color:#999;">å°šæœªæœ‰é»é¤ç´€éŒ„</td></tr>
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td colspan="2">å…¨é«”ç¸½è¨ˆé‡‘é¡</td>
                    <td id="grandTotal">NT.0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="status-panel">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>ç³»çµ±ç‹€æ…‹ (2s è‡ªå‹•æ›´æ–°)</span>
            <span id="updateTime"></span>
        </div>
        <div id="statusLog"></div>
    </div>
</div>

<script>
    // --- å®Œæ•´èœå–®è³‡æ–™ (å«åƒ¹æ ¼) ---
    const menuData = {
        "Appetizer å‰èœ": [
            { id: 1, name: "[çƒ¤ç¶œåˆæ™‚è”¬]", price: 180 },
            { id: 2, name: "[ç¾å¼é…¥ç‚¸è–¯æ¢]", price: 120 },
            { id: 3, name: "[å¹¸ç¦ç‚¸é›]", price: 180 },
            { id: 4, name: "[å°å°¼é¢¨æƒ…è¾£é›ç¿…]", price: 220 }
        ],
        "Main Course ä¸»é¤": [
            { id: 5, name: "çœ‹è‘—ç‰ç±³ç”°çš„ç‰›å°æ’", price: 580 },
            { id: 6, name: "æ…¢ç…®è±¬æ¢…èŠ±æ’", price: 380 },
            { id: 7, name: "çˆçƒ¤å…«å…©é›è…¿æ’", price: 300 },
            { id: 8, name: "æ²¹å°é´¨è…¿", price: 380 }
        ],
        "Risotto/Pasta é£¯éºµ": [
            { id: 9, name: "å¹²è²å°å·ç« é­šæ±ç‡‰é£¯", price: 350 },
            { id: 10, name: "å‰çš®è¾£æ¤’é›ç‡‰é£¯", price: 280 },
            { id: 11, name: "è’œæ¢¨é†¬è±¬äº”èŠ±ç¾©å¤§åˆ©éºµ", price: 260 }
        ]
    };

    // å„²å­˜æ‰€æœ‰äººçš„è¨‚å–®ç´€éŒ„
    let allOrders = {}; // æ ¼å¼: { "å¼µä¸‰": { items: ["é›è…¿æ’", "è–¯æ¢"], total: 420 } }
    let selectedPerson = "ä¸€èµ·åƒ";

    // 1. åˆå§‹åŒ–èœå–®
    function initMenu() {
        const menuContainer = document.getElementById('menuContent');
        for (const [cat, items] of Object.entries(menuData)) {
            let html = `<div class="category-title">${cat}</div>`;
            items.forEach(item => {
                html += `
                    <div class="item">
                        <span>${item.name}</span>
                        <div style="display:flex; align-items:center">
                            <span class="price">NT.${item.price}</span>
                            <input type="checkbox" class="menu-cb" data-name="${item.name}" data-price="${item.price}">
                        </div>
                    </div>
                `;
            });
            menuContainer.innerHTML += html;
        }
    }

    // 2. äººå“¡é¸æ“‡
    function addPerson() {
        const name = document.getElementById('personNameInput').value.trim();
        if (!name) return;
        const list = document.getElementById('personList');
        const tag = document.createElement('div');
        tag.className = 'person-tag';
        tag.innerText = name;
        tag.onclick = function() { selectPerson(this); };
        list.appendChild(tag);
        document.getElementById('personNameInput').value = "";
    }

    function selectPerson(el) {
        document.querySelectorAll('.person-tag').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        selectedPerson = el.innerText;
        document.getElementById('currentUserDisplay').innerText = selectedPerson;
    }

    // 3. é€å‡ºè¨‚å–®ä¸¦è¨ˆç®—å°è¨ˆ
    function sendOrder() {
        const checkedItems = document.querySelectorAll('.menu-cb:checked');
        if (checkedItems.length === 0) return alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …é¤é»");

        let currentItems = [];
        let currentTotal = 0;

        checkedItems.forEach(cb => {
            currentItems.push(cb.getAttribute('data-name'));
            currentTotal += parseInt(cb.getAttribute('data-price'));
            cb.checked = false; // é€å‡ºå¾Œæ¸…ç©ºå‹¾é¸
        });

        // æ›´æ–°å¸³å–®ç´€éŒ„ (å¦‚æœåŒä¸€å€‹äººé»å…©æ¬¡ï¼Œæœƒç´¯åŠ )
        if (!allOrders[selectedPerson]) {
            allOrders[selectedPerson] = { items: [], total: 0 };
        }
        allOrders[selectedPerson].items.push(...currentItems);
        allOrders[selectedPerson].total += currentTotal;

        updateSummaryTable();
        logSystem(`[è¨‚å–®å·²æ¥æ”¶] ${selectedPerson} é»äº† ${currentItems.length} é …ï¼Œé‡‘é¡ $${currentTotal}`);
    }

    // 4. æ›´æ–°å°è¨ˆè¡¨æ ¼
    function updateSummaryTable() {
        const body = document.getElementById('summaryBody');
        const grandTotalEl = document.getElementById('grandTotal');
        body.innerHTML = "";
        let grandTotal = 0;

        for (const [name, data] of Object.entries(allOrders)) {
            const row = `
                <tr>
                    <td><b>${name}</b></td>
                    <td style="font-size:0.85rem">${data.items.join('ã€')}</td>
                    <td style="color:#d32f2f">NT.${data.total}</td>
                </tr>
            `;
            body.innerHTML += row;
            grandTotal += data.total;
        }
        grandTotalEl.innerText = `NT.${grandTotal}`;
    }

    // 5. è‡ªå‹•æ›´æ–°æ—¥èªŒ (æ¨¡æ“¬å¾Œç«¯)
    function logSystem(msg) {
        const log = document.getElementById('statusLog');
        const time = new Date().toLocaleTimeString();
        log.innerHTML = `<div class="status-line">>> [${time}] ${msg}</div>` + log.innerHTML;
        document.getElementById('updateTime').innerText = time;
    }

    setInterval(() => {
        const randomMsgs = ["é€£ç·šç©©å®š", "å»šæˆ¿æ¥æ”¶ä¸­", "é›²ç«¯åŒæ­¥å®Œæˆ", "è‡ªå‹•å‚™ä»½ä¸­"];
        logSystem(randomMsgs[Math.floor(Math.random()*randomMsgs.length)]);
    }, 2000);

    initMenu();
</script>

</body>
</html>
