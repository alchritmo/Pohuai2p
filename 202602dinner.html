<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â≥∂‰πãÂæå In the Island After - Ëó•ÂäëÁßëÂ∞àÂ±¨ÈªûÈ§ê</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .member-btn.active { background-color: #06b6d4; border-color: #22d3ee; box-shadow: 0 0 25px rgba(34, 211, 238, 0.7); transform: scale(1.05); }
        .category-title { border-left: 8px solid #22d3ee; padding-left: 1.5rem; margin-bottom: 2rem; font-size: 2.2rem; font-weight: 900; color: #22d3ee; letter-spacing: -0.05em; }
        input[type=number]::-webkit-inner-spin-button { opacity: 1; }
        #order-summary-list::-webkit-scrollbar { width: 5px; }
        #order-summary-list::-webkit-scrollbar-thumb { background: #0891b2; border-radius: 10px; }
        .glass-card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(51, 65, 85, 0.5); }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen pb-40 font-sans tracking-tight">

    <div class="max-w-6xl mx-auto px-4 py-12">
        <header class="text-center mb-20">
            <h1 class="text-8xl font-black text-transparent bg-clip-text bg-gradient-to-br from-cyan-300 via-cyan-500 to-blue-600 tracking-tighter mb-4">Âú®Â≥∂‰πãÂæå</h1>
            <p class="text-2xl text-slate-500 font-bold tracking-[0.3em] uppercase opacity-80">After Island ¬∑ Cloud Ordering System</p>
        </header>

        <section class="mb-16 glass-card p-10 rounded-[3rem] shadow-2xl text-center border-cyan-900/30">
            <h2 class="text-3xl font-black text-cyan-400 mb-8 italic">Step 1. Ë™∞Âú®ÈªûÈ§êÔºü (Who's ordering)</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6" id="memberList"></div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-14">
            <div class="lg:col-span-2 space-y-20" id="menu-sections">
                <h2 class="text-5xl font-black text-white italic border-b-4 border-slate-800 pb-6 mb-10">Step 2. ÈÅ∏È§ê MENU</h2>
            </div>

            <div class="lg:col-span-1">
                <div class="sticky top-10 glass-card rounded-[3rem] p-10 border-2 border-cyan-500 shadow-[0_0_60px_rgba(8,145,178,0.2)]">
                    <h2 class="text-3xl font-black text-cyan-400 mb-8 flex items-center">
                        <span class="animate-ping absolute h-4 w-4 rounded-full bg-red-500 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-4 w-4 bg-red-600 mr-5"></span>
                        Âç≥ÊôÇÂåØÊï¥Ê∏ÖÂñÆ
                    </h2>
                    
                    <div id="order-summary-list" class="space-y-6 max-h-[50vh] overflow-y-auto pr-3 text-xl font-medium">
                        <p class="text-slate-600 text-center py-10 animate-pulse">Ê≠£Âú®ËàáÈõ≤Á´ØÂêåÊ≠•...</p>
                    </div>

                    <div class="mt-10 pt-8 border-t-2 border-slate-800 text-right">
                        <p class="text-slate-500 text-lg font-bold mb-2">Grand Total</p>
                        <p class="text-6xl font-black text-green-400 tabular-nums">
                            <span class="text-2xl font-normal mr-1">NT$</span><span id="grandTotalDisplay">0</span>
                        </p>
                    </div>
                    <div class="mt-6 text-center">
                        <button onclick="fetchFromCloud()" class="text-xs text-cyan-800 hover:text-cyan-400 font-mono tracking-widest uppercase transition-colors">‚Üª Force Refresh</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Ê†∏ÂøÉÈÄ£Á∑öÁ∂≤ÂùÄ ---
        const GAS_URL = "https://script.google.com/macros/s/AKfycbxCXGkj0OunqXC9byaTqtlAaK8ISrjIHAZQG0ns4zCS1rrR7pE5jZB7_AFk-Cu_xjZw/exec";
        
        // --- Ëó•ÂäëÁßë 8 ‰∫∫ÂêçÂñÆ ---
        const members = ["Á†¥Â£û", "ÈòøÊ≠£", "Ëê¨Ëê¨", "luka", "Neo", "Â∞èÈêµ", "morrisss", "+„Ñé"];
        let currentMember = "";

        // --- ÂÆåÊï¥ËèúÂñÆÊï∏ÊìöÂ∫´ ---
        const menuData = {
            "APPETIZER ÂâçËèú": [
                { name: "[ÁÉ§Á∂úÂêàÊôÇËî¨]", price: 180, desc: "Grilled Seasonal Vegetables" },
                { name: "[ÁæéÂºèÈÖ•ÁÇ∏ËñØÊ¢ù]", price: 120, desc: "House French Fries" },
                { name: "[ÁæéÂºèËÇâÈÜ¨ËñØÊ¢ù]", price: 200, desc: "Á¥îË±¨Áæ©ÂºèËÇâÈÜ¨ / Â∞èËæ£ / Ëá™Ë£ΩÈÖ∏Â•∂ÈÜ¨" },
                { name: "[Âπ∏Á¶èÁÇ∏Èõû]", price: 180, desc: "ÈõûËÖøËÇâ / ÁöÆËÑÜ / ÁèæÈªûÁèæÁÇ∏ / Ëá™Ë£ΩÂ°îÂ°îÈÜ¨" },
                { name: "[Âç∞Â∞ºÈ¢®ÊÉÖËæ£ÈõûÁøÖ]", price: 220, desc: "ÊúâÂÖ≠Èöª / ÊúÉËæ£ / Ëä±ÁîüÁ¢é / È¶ôÊñô" },
                { name: "[Êå™Â®ÅÈÆ≠È≠öËè†ËèúÈÜ¨]", price: 380, desc: "ÁîüÈ£üÁ¥öÈÆ≠È≠ö / ÊæéÊπñÂ∞èÂç∑ / ‰ΩêÊùè‰ªÅËïéÈ∫•Â•∂ÈÜ¨" }
            ],
            "MAIN COURSE ‰∏ªÈ§ê": [
                { name: "ÁúãËëóÁéâÁ±≥Áî∞ÁöÑÁâõÂ∞èÊéí", price: 580, desc: "ÁæéÂúãÁ©ÄÈ£ºÁâõ / ‰ΩêÁ∂ìÂÖ∏ÊùæÈú≤Á¥ÖÈÖíÈÜ¨" },
                { name: "ÊÖ¢ÁÖÆË±¨Ê¢ÖËä±Êéí", price: 380, desc: "ÈªëÁ≥ñÈ¶ôËåÖÂ•∂Ê≤πÊ±Å / ÁÑ¶Á≥ñËòãÊûú" },
                { name: "ÁàêÁÉ§ÂÖ´ÂÖ©ÈõûËÖøÊéí", price: 300, desc: "Ë£Ω‰ΩúÁ¥Ñ20ÂàÜÈêò / ÁöÆËÑÜÂøÉËªüËÇâÂ§ßÂ°ä" },
                { name: "Ê≤πÂ∞ÅÈ¥®ËÖø‰ΩêÂ∞èËæ≤‰ΩúÁâ©", price: 380, desc: "Ê≤πÂ∞ÅÈ¥®ËÖø / ‰ΩêËñÑËç∑È¥®Ê±ÅÂ•∂Ê≤πÈÜ¨" },
                { name: "ÈÖçÈ§êÈ∫µÂåÖ/‰∏âÊòéÊ≤ª/ÊπØÂìÅ", price: 50, desc: "Side Bread & Soup" }
            ],
            "SOUP & SALAD ÊπØÂìÅÊ≤ôÊãâ": [
                { name: "‰ªäÊó•‰æãÊπØ (Chef Soup)", price: 50, desc: "Ëá™ÁÜ¨È´òÊπØ / ‰∏çÁî®Âë≥Á≤æ / ÁúãÂøÉÊÉÖÁÖÆ" },
                { name: "Ë•øÁè≠ÁâôÁîüÁÅ´ËÖøÊ∞¥ÊûúÊ≤ôÊãâ(Â∞è)", price: 200, desc: "1~2‰∫∫‰ªΩ / Â≠£ÁØÄÊ∞¥Êûú / ÈáëÊ°îÊ≤πÈÜ¨" },
                { name: "Ë•øÁè≠ÁâôÁîüÁÅ´ËÖøÊ∞¥ÊûúÊ≤ôÊãâ(Â§ß)", price: 360, desc: "3~5‰∫∫‰ªΩ / Â≠£ÁØÄÊ∞¥Êûú / ÈáëÊ°îÊ≤πÈÜ¨" },
                { name: "Ê≥∞Ê£í‰∫ÜÊ§íÈ∫ªÈõûÊ≤ôÊãâ(Â∞è)", price: 180, desc: "1~2‰∫∫‰ªΩ / ÈÖ•ËÑÜÁÇ∏Èõû / ÊúâÈ¶ôËèú" },
                { name: "Ê≥∞Ê£í‰∫ÜÊ§íÈ∫ªÈõûÊ≤ôÊãâ(Â§ß)", price: 380, desc: "3~5‰∫∫‰ªΩ / ÈÖ•ËÑÜÁÇ∏Èõû / ÊúâÈ¶ôËèú" }
            ],
            "RISOTTO ÁáâÈ£Ø": [
                { name: "Âπ≤Ë≤ùÂ∞èÂç∑Á´†È≠öÊ±ÅÁáâÈ£Ø", price: 350, desc: "ÊæéÊπñÁîüÈ£üÁ¥öÂ∞èÂç∑ / ÂåóÊµ∑ÈÅìÂπ≤Ë≤ù / Ëñ∞Ë°£Ëçâ" },
                { name: "ÂâùÁöÆËæ£Ê§íÈõûÁáâÈ£Ø", price: 280, desc: "Âè∞Êù±ÂâùÁöÆËæ£Ê§í / Ëá™ÁÜ¨ÈõûÈ´òÊπØ / Ë∂äÂÖâÁ±≥" },
                { name: "Áçµ‰∫∫ÁáâÈõûÁáâÈ£Ø", price: 300, desc: "ÈªëÊ©ÑÊ¨ñ / ÈáéËèá / Âè∞ÁÅ£Ë∂äÂÖâÁ±≥" },
                { name: "Áæ©ÂºèÊùæÈú≤ÈáéËèáÁáâÈ£Ø", price: 320, desc: "ÁÇ∏ÈáéËèá / ÊùæÈú≤ÈÜ¨ / ÁéÑÁ±≥Ëå∂" }
            ],
            "PASTA Áæ©Â§ßÂà©È∫µ": [
                { name: "ËíúÊ¢®ÈÜ¨Ë±¨‰∫îËä±È∫µ", price: 260, desc: "Ë±¨‰∫îËä± / ËíúÊ¢®ÈÜ¨ (Ê∞¥Ê¢®„ÄÅÂ§ßËíú)" },
                { name: "Êµ∑ÁìúÂ≠êËõ§Ë†£ËñÑËç∑È∫µ", price: 280, desc: "Ëõ§Ë†£ / Êµ∑ÁìúÂ≠ê / ÁôΩÈÖíÁÖ®ÁÖÆ / Ê∏ÖÊñ∞ËñÑËç∑" },
                { name: "ÈáéËèáÂüπÊ†πÁôΩÈÜ¨È∫µ", price: 250, desc: "Ëá™ÁÜ¨ÈõûÈ´òÊπØ / ÂúüÈõûËõãÈªÉ / ÁÖôÁáªÁ¥ÖÊ§íÁ≤â" },
                { name: "Á∂ìÂÖ∏ËÇâÈÜ¨Áæ©Â§ßÂà©È∫µ", price: 240, desc: "Ë±¨ËÇâ / Áï™ËåÑÁ¥ÖÈÜ¨ / ÂæàÂ§öËæõÈ¶ôÊñô" }
            ],
            "SPECIAL Êº¢Â†°ËÇâÊéíÈ£Ø": [
                { name: "Ê≤ñÁπ©Â°îÂèØÈ£Ø", price: 260, desc: "Â¢®Ë•øÂì•Ë±¨ËÇâÈÜ¨ / Â§öÂäõÂ§öÊªã / Ëá™Ë£ΩÈÖ∏Â•∂ÈÜ¨", options: false },
                { name: "100%Ë±¨ËÇâÊº¢Â†°ÊéíÈ£Ø", price: 220, desc: "100%Á¥îË±¨ËÇâ / Â≠£ÁØÄÊôÇËî¨", options: true },
                { name: "ÁâõËÇâÊº¢Â†°ÊéíÈ£Ø", price: 260, desc: "ÁâõË±¨ÊØî‰æã 8:2 / Â≠£ÁØÄÊôÇËî¨", options: true }
            ]
        };

        // --- ÂàùÂßãÂåñ UI ---
        function init() {
            const memberContainer = document.getElementById('memberList');
            members.forEach(m => {
                const btn = document.createElement('button');
                btn.className = "member-btn border-2 border-slate-800 p-6 rounded-3xl text-3xl font-black hover:border-cyan-500 transition-all duration-300 bg-slate-900/50";
                btn.innerText = m;
                btn.onclick = () => {
                    document.querySelectorAll('.member-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentMember = m;
                };
                memberContainer.appendChild(btn);
            });

            const menuRoot = document.getElementById('menu-sections');
            for (const [cat, items] of Object.entries(menuData)) {
                let html = `<div class="bg-slate-900/40 p-10 rounded-[3rem] border border-slate-800/50 shadow-inner">
                    <h3 class="category-title italic tracking-tighter">${cat}</h3>`;
                items.forEach(item => {
                    let optionHtml = "";
                    if (item.options) {
                        optionHtml = `
                            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-lg">
                                <div class="flex flex-col">
                                    <label class="text-xs text-slate-500 mb-1 uppercase font-bold tracking-widest">ÈÜ¨Ê±Å Sauce</label>
                                    <select id="sauce-${item.name}" class="bg-slate-800 text-cyan-400 rounded-xl p-3 border border-slate-700 outline-none focus:border-cyan-500">
                                        <option value="Á¥ÖÈÖíÈÜ¨">Á¥ÖÈÖíÈÜ¨ (Red Wine Sauce)</option>
                                        <option value="ËíúÊ¢®ÈÜ¨">ËíúÊ¢®ÈÜ¨ (Peach-Garlic Sauce)</option>
                                    </select>
                                </div>
                                <div class="flex flex-col">
                                    <label class="text-xs text-slate-500 mb-1 uppercase font-bold tracking-widest">Âä†Ë≥º Add-ons</label>
                                    <div class="flex items-center space-x-6 h-full">
                                        <label class="flex items-center space-x-2 cursor-pointer group">
                                            <input type="checkbox" id="cheese-${item.name}" class="w-6 h-6 rounded bg-slate-800 border-slate-700 accent-cyan-500">
                                            <span class="group-hover:text-cyan-400 transition">Ëµ∑Âè∏ (+10)</span>
                                        </label>
                                        <label class="flex items-center space-x-2 cursor-pointer group">
                                            <input type="checkbox" id="egg-${item.name}" class="w-6 h-6 rounded bg-slate-800 border-slate-700 accent-cyan-500">
                                            <span class="group-hover:text-cyan-400 transition">Ëç∑ÂåÖËõã (+20)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>`;
                    }
                    html += `<div class="bg-slate-900/80 p-8 rounded-[2.5rem] mb-8 border border-slate-800 shadow-xl">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                            <div class="mb-6 md:mb-0">
                                <div class="text-3xl font-bold text-white">${item.name}</div>
                                <div class="text-slate-500 text-lg mt-1 font-medium">${item.desc}</div>
                                <div class="text-cyan-600 font-black text-2xl mt-3 tracking-widest italic">NT$ ${item.price}</div>
                            </div>
                            <div class="flex items-center space-x-6 w-full md:w-auto">
                                <div class="flex items-center bg-slate-800 rounded-2xl border border-slate-700 p-1">
                                    <button onclick="changeQty('${item.name}', -1)" class="w-14 h-14 flex items-center justify-center hover:bg-slate-700 rounded-xl text-3xl font-black text-cyan-500">-</button>
                                    <input type="number" id="input-${item.name}" value="0" min="0" class="w-16 bg-transparent text-center text-3xl font-black border-none focus:ring-0">
                                    <button onclick="changeQty('${item.name}', 1)" class="w-14 h-14 flex items-center justify-center hover:bg-slate-700 rounded-xl text-3xl font-black text-cyan-500">+</button>
                                </div>
                                <button onclick="sendToCloud('${item.name}', ${item.price}, ${item.options})" class="flex-grow md:flex-none bg-cyan-600 hover:bg-cyan-500 px-10 py-5 rounded-2xl font-black text-2xl shadow-lg transition active:scale-95 text-white">Êõ¥Êñ∞</button>
                            </div>
                        </div>
                        ${optionHtml}
                    </div>`;
                });
                menuRoot.innerHTML += html + `</div>`;
            }
        }

        function changeQty(id, delta) {
            const input = document.getElementById(`input-${id}`);
            input.value = Math.max(0, parseInt(input.value) + delta);
        }

        // --- Â§ö‰∫∫ÂêåÊ≠•Ôºö‰∏äÂÇ≥Èõ≤Á´Ø ---
        async function sendToCloud(itemName, price, hasOptions) {
            if (!currentMember) return alert("üì¢ Ëó•Â∏´ÊèêÈÜíÔºöË´ãÂÖàÈÅ∏ÊìáÈªûÈ§ê‰∫∫ÂêçÂ≠óÔºÅ");
            
            const qty = parseInt(document.getElementById(`input-${itemName}`).value);
            let finalName = itemName;
            let finalPrice = price;

            if (hasOptions && qty > 0) {
                const sauce = document.getElementById(`sauce-${itemName}`).value;
                const cheese = document.getElementById(`cheese-${itemName}`).checked;
                const egg = document.getElementById(`egg-${itemName}`).checked;
                finalName += ` [${sauce}${cheese?'+Ëµ∑Âè∏':''}${egg?'+Ëõã':''}]`;
                if (cheese) finalPrice += 10;
                if (egg) finalPrice += 20;
            }

            const btn = event.currentTarget;
            btn.innerText = "ÂÇ≥ÈÄÅ‰∏≠...";
            btn.disabled = true;

            try {
                await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ name: currentMember, item: finalName, price: finalPrice, qty: qty })
                });
                btn.innerText = "Â∑≤Êõ¥Êñ∞";
                btn.classList.replace('bg-cyan-600', 'bg-green-600');
            } catch (e) {
                alert("‚ùå ÈÄ£Á∑öÁï∞Â∏∏ÔºåË´ãÁ¢∫Ë™ç GAS ÈÉ®ÁΩ≤ÊòØÂê¶Ê≠£Á¢∫");
            }

            setTimeout(() => {
                btn.innerText = "Êõ¥Êñ∞";
                btn.disabled = false;
                btn.classList.replace('bg-green-600', 'bg-cyan-600');
            }, 1000);
            fetchFromCloud();
        }

        // --- Â§ö‰∫∫ÂêåÊ≠•Ôºö‰∏ãËºâÈõ≤Á´Ø ---
        async function fetchFromCloud() {
            try {
                const res = await fetch(GAS_URL);
                const data = await res.json();
                renderSummary(data);
            } catch (e) { console.error("ÂêåÊ≠•Â§±Êïó: ", e); }
        }

        function renderSummary(data) {
            const listDiv = document.getElementById('order-summary-list');
            let html = "";
            let grandTotal = 0;

            const grouped = data.reduce((acc, obj) => {
                acc[obj.name] = acc[obj.name] || [];
                acc[obj.name].push(obj);
                return acc;
            }, {});

            if (data.length === 0) {
                listDiv.innerHTML = '<p class="text-center py-10 italic text-slate-700">ÁõÆÂâçÂ∞öÁÑ°‰∫∫ÈªûÈ§ê</p>';
                document.getElementById('grandTotalDisplay').innerText = "0";
                return;
            }

            for (const name in grouped) {
                let userSubtotal = 0;
                html += `<div class="bg-slate-800/80 p-6 rounded-[2rem] border border-slate-700 mb-5 shadow-xl transition-all hover:border-cyan-900">
                    <div class="text-cyan-400 font-black text-2xl border-b border-slate-700/50 pb-3 mb-4 flex justify-between">
                        <span>${name}</span>
                        <span class="text-xs text-slate-500 mt-2 font-mono tabular-nums uppercase tracking-widest">Sub: $${grouped[name].reduce((a,b)=>a+(b.price*b.qty),0)}</span>
                    </div>`;
                grouped[name].forEach(o => {
                    const sub = o.price * o.qty;
                    userSubtotal += sub;
                    html += `<div class="flex justify-between text-lg mb-2">
                        <span class="text-slate-200 font-medium">${o.item} <span class="text-cyan-600 font-black ml-2">x${o.qty}</span></span>
                        <span class="font-mono text-slate-400 tabular-nums">$${sub}</span>
                    </div>`;
                });
                html += `</div>`;
                grandTotal += userSubtotal;
            }
            listDiv.innerHTML = html;
            document.getElementById('grandTotalDisplay').innerText = grandTotal.toLocaleString();
        }

        init();
        fetchFromCloud();
        // ÊØè 2 ÁßíÂêåÊ≠•‰∏ÄÊ¨°
        setInterval(fetchFromCloud, 2000);
    </script>
</body>
</html>
